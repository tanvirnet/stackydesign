/* consentBanner */ consentBanner&&(document.cookie.split("; ").find((e=>e.startsWith("cookieConsent=")))||(rClass(consentBanner,"hidden"),consentBanner.querySelector(".accept").addEventListener("click",(()=>{document.cookie="cookieConsent=true; max-age=2592000; path=/",aClass(consentBanner,"hidden")}))));
/* dark */ function dark(){const e=D.documentElement,t="dark"===getA(e,"data-scheme")?"light":"dark";setA(e,"data-scheme",t),S.setItem("theme",t)}
/* header */ if(header){let e=header,l=0;W.addEventListener("scroll",(()=>{let s=scrollY;e.classList.toggle("pin",s>140&&s>l),e.classList.toggle("pin-fixed",s>140),l=s}))}
/* book */ if(book){function updateSaveButtons(t){let e=$$(`.save-this[data-postId='${t}']`),o=(JSON.parse(S.getItem("bookmarkedPosts"))||[]).includes(t);e.forEach((t=>{o?aClass(t,"saved"):rClass(t,"saved")}))}function loadSavedPosts(){(JSON.parse(S.getItem("bookmarkedPosts"))||[]).forEach((t=>updateSaveButtons(t))),updateBookmarkCount()}function updateBookmarkCount(){let t=JSON.parse(S.getItem("bookmarkedPosts"))||[];$("#book-count").setAttribute("data-text",t.length)}function initializeSaveButtons(){$$(".save-this").forEach((t=>{t.addEventListener("click",(()=>{let e=getA(t,"data-postId"),o=JSON.parse(S.getItem("bookmarkedPosts"))||[],a=o.indexOf(e);-1===a?o.push(e):o.splice(a,1),S.setItem("bookmarkedPosts",JSON.stringify(o)),updateSaveButtons(e),updateBookmarkCount()}))}))}initializeSaveButtons(),loadSavedPosts()}
/* pagination */ if(pagination){$(".pagination .btn").addEventListener("click",(function(){let t=this,e=getA(t,"data-action"),a=this.textContent;e?(aClass(t,"loading"),t.textContent="Loading...",setA(t,"disabled"),fetch(e).then((t=>t.text())).then((e=>{let n=(new DOMParser).parseFromString(e,"text/html"),i=Array.from(n.querySelectorAll(".blog >.posts article")).map((t=>t.outerHTML)).join("");$(".blog >.posts").innerHTML+=i;let o=n.querySelector(".pagination .btn[data-action]")?.getAttribute("data-action");o?setA(t,"data-action",o):pagination?.setAttribute("hidden",""),rClass(t,"loading"),t.textContent=a,t.removeAttribute("disabled"),initializeSaveButtons(),loadSavedPosts()})).catch((e=>{rClass(t,"loading"),t.textContent=a,t.removeAttribute("disabled")}))):pagination?.setAttribute("hidden","")}))}
/* read time */ if(readTime){function o(e){let d="",n=e.childNodes.length;for(let t=0;t<n;t++){let n=e.childNodes[t];8!==n.nodeType&&(d+=1!==n.nodeType?n.nodeValue:o(n))}return d}let e,d=Math.round(o(postBody).split(" ").length/200);e=0===d||1===d?"minute read":"minutes read",readTime.innerHTML=`${d} ${e}`}
/* share */ share&&share.addEventListener("click",(function(){let t=getA(this,"data-url");navigator.clipboard.writeText(t).then((()=>{let t=this.querySelector("span"),e=t.textContent;t.textContent="Link was copied",setTimeout((()=>{t.textContent=e}),1e3)}))}));
/* pre copy */ preCopy&&preCopy.forEach((e=>{e.addEventListener("click",(()=>{const t=e.closest(".pre")?.querySelector("pre");if(!t)return;const o=t.innerText;navigator.clipboard.writeText(o).then((()=>{e.setAttribute("data-copy","Copied."),e.classList.add("copied"),setTimeout((()=>{e.setAttribute("data-copy","Copy to clipboard."),e.classList.remove("copied")}),1e3)}))}))}));

/* Related */
if (related) {
!function(){const e=related;if(!e)return;const t=(e,t)=>e.getAttribute(t),a=t(e,"data-label-1"),l=t(e,"data-label-2"),n=t(e,"data-postid");if(!a)return;const s=(t,a)=>{fetch(t).then((e=>e.json())).then((t=>{if(!t.feed||!t.feed.entry)return void(a&&s("/feeds/posts/default/?alt=json&max-results=50",!1));let l=t.feed.entry;l=l.filter((e=>!e.id?.$t?.includes(n))),0===l.length&&a?s("/feeds/posts/default/?alt=json&max-results=50",!1):l.length>0&&(t=>{t=t.sort((()=>.5-Math.random())).slice(0,4);let a="";t.forEach((e=>{const t=e.title?.$t,l=e.link.find((e=>"alternate"===e.rel))?.href,n=e.media$thumbnail?e.media$thumbnail.url.replace(/\/s\d+-c/,"/s300-c"):settings.defaultImg;a+=`<article class='article flex align-center gap14'><a class='pointer' href='${l}'><img loading='lazy' src='${n}' alt="${t}"/></a><h4><a href='${l}'>${t}</a></h4></article>`})),e.innerHTML=a})(l)})).catch((t=>{e.innerHTML='<div class="nothing grid center">Failed to load post, seems to be internet problem.</div>'}))},r=l?`/feeds/posts/default/?q=label:${encodeURIComponent(a)}|label:${encodeURIComponent(l)}&alt=json&max-results=50`:`/feeds/posts/default/?q=label:${encodeURIComponent(a)}&alt=json&max-results=50`;s(r,!0)}();
}

/* Table */
if (tableOfContents) {
setTimeout(() => {
!function(){let e=postBody,t=tableOfContents;if(!e||!t)return;let l=e.querySelectorAll("h1, h2, h3, h4, h5, h6");if(!l.length)return;let n=new Set,r=[],i=[r];l.forEach((e=>{let t=parseInt(e.tagName[1],10),l=e.id||function(e){let t=e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),l=t,r=1;for(;n.has(l);)l=`${t}-${r++}`;return n.add(l),l}(e.textContent);e.id=l;let h={id:l,text:e.textContent.trim(),level:t,children:[]};(i[t-1]||r).push(h),i=i.slice(0,t),i[t]=h.children})),t.innerHTML=function e(t){let l="<ol>";return t.forEach((t=>{l+=`<li><a href="#${t.id}">${t.text}</a>`,t.children.length&&(l+=e(t.children)),l+="</li>"})),l+="</ol>",l}(r)}();
}, "1000");
}

/* Bookmark */
if (bookPosts) {
!function(){let e="<div class='nothing big flex column center gap16'><p>It looks like you haven't added anything yet. Don't leave this blank, <span>add your favorite articles now.</span></p><a class=\"btn big round\" href=\"/\">Let's add one!</a></div>";function t(t){let o=bookPosts;o.innerHTML="",t.forEach((t=>{let a=t.entry,n=a.title.$t,l=a.link.find((e=>"alternate"===e.rel)).href,s=a.media$thumbnail?a.media$thumbnail.url.replace(/\/s\d+-c/,"/s300-c"):settings.defaultImg,i=a.id.$t.split(".post-").pop(),r=D.createElement("article");r.className="book-post flex align-center gap14",r.innerHTML=`<a class='pointer' href="${l}"><img loading='lazy' src="${s}" alt="${n}"></a><h2 class='title nomargin'><a href="${l}">${n}</a></h2><div class="book-del flex center pointer" data-postId="${i}"><svg class="line" viewBox="0 0 24 24"><path d="M 18.645 9.251 L 18.649 12.575 M 17.667 19.142 L 15.545 17.021 M 15.544 21.263 L 17.667 19.142 M 19.788 17.021 L 17.667 19.142 M 17.666 19.142 L 19.787 21.263 M 8.625 5.217 L 15.375 5.217 M 4.212 5.217 L 8.821 5.217 M 19.788 5.217 L 15.179 5.217 M 8.625 5.203 L 8.625 4.19 C 8.625 3.085 9.52 2.19 10.625 2.19 L 13.375 2.19 C 14.479 2.19 15.375 3.085 15.375 4.19 L 15.375 5.203 M 10.844 21.263 L 7.53 21.263 C 6.454 21.263 5.532 20.618 5.346 19.735 L 5.355 9.251"></path></svg></div>`,o.appendChild(r),r.querySelector(".book-del").addEventListener("click",(()=>{!function(t){let o=JSON.parse(S.getItem("bookmarkedPosts"))||[];o=o.filter((e=>e!==t)),S.setItem("bookmarkedPosts",JSON.stringify(o)),$(`.book-del[data-postId='${t}']`)?.closest(".book-post")?.remove(),updateBookmarkCount(),0===o.length&&(bookPosts.innerHTML=e)}(i)}))}))}(()=>{let o=bookPosts;if(!o)return;let a=JSON.parse(S.getItem("bookmarkedPosts"))||[];0!==a.length?Promise.all(a.map((e=>fetch(`/feeds/posts/default/${e}?alt=json`).then((e=>e.json()))))).then((a=>{let n=a.filter(Boolean);0===n.length?o.innerHTML=e:t(n)})).catch((()=>{o.innerHTML=e})):o.innerHTML=e})()}();
}

/* Filter */
if (filter) {
!function(){const e=$(".blog >.posts"),t=$(".pagination"),n=$$(".filter-button .btn"),i=$(".filter-name"),s=e.innerHTML;let l=$(".pagination [data-action]"),a=i.textContent,o=S.getItem("has-filter")||"",r=1,d=[],c=12;function m(){const n=r*c;e.innerHTML=d.slice(0,n).join(""),initializeSaveButtons(),loadSavedPosts(),function(){let e=$(".filter-more");e&&e.remove();if(d.length>r*c){let e=D.createElement("button");e.className="filter-more btn big round",e.innerText=l.innerText,e.onclick=()=>{const t=e;t.innerText="Loading...",aClass(t,"loading"),setTimeout((()=>{r++,m(),t.innerText=l.innerText,rClass(t,"loading")}),500)},t.appendChild(e),t.hidden=!1}else t.hidden=!0}()}n.forEach((a=>{a.addEventListener("click",(()=>{if($("input[id=filter]").checked=!1,n.forEach((e=>rClass(e,"selected"))),aClass(a,"selected"),o=a.dataset.value,S.setItem("has-filter",o),i.textContent=a.innerText,r=1,d=[],e.classList.remove("error","nothing","big","flex","column","center","gap16"),e.classList.add("posts","grid"),""===o){e.innerHTML=s,t.hidden=!1,l.hidden=!1;let n=$(".filter-more");n&&n.remove(),initializeSaveButtons(),loadSavedPosts()}else t.hidden=!0,l.hidden=!0,e.innerHTML=Array(12).fill('<div class="d-skeleton flex column gap20"><i class="img"></i><i class="flex column gap8"><i class="text" style="max-width:100px"></i><i class="text i" style="max-width: 260px;"></i><i class="text i" style="max-width:180px"></i></i></div>').join(""),function(t){let n=`/search/label/${encodeURIComponent(t)}?max-results=12`;fetch(n).then((e=>e.text())).then((t=>{let n=(new DOMParser).parseFromString(t,"text/html");if(d=Array.from(n.querySelectorAll(".blog >.posts article")).map((e=>e.outerHTML)),0===d.length)return e.classList.remove("posts","grid"),e.classList.add("nothing","big","flex","column","center","gap16"),void(e.innerHTML="<p class='nomargin'>Nothing can be found at the moment.</p>");m()})).catch((t=>{console.error("Error loading posts:",t),e.classList.remove("posts","grid"),e.classList.add("error","nothing","big","flex","column","center","gap16"),e.innerHTML="<p class='nomargin'>Failed to load post, seems to be internet problem.</p>"}))}(o)}))})),o?($(`.filter-button  .btn[data-value="${o}"]`)?.click(),i.textContent=o):(i.textContent=a,initializeSaveButtons(),loadSavedPosts())}();
}
